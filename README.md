# Диагностика доступности сайтов

Минималистичный статический сайт для GitHub Pages: проверка доступности доменов с текущего устройства (в РФ часть ресурсов может быть заблокирована или недоступна). **Только диагностика, без обхода блокировок.**

## Что делает

- Показывает сводный статус: **всё ок** / **частично не ок** / **нет интернета или сломался DNS**.
- Подгружает списки доменов из репозитория [itdoginfo/allow-domains](https://github.com/itdoginfo/allow-domains) (Russia inside/outside RAW, сервисы: Discord, YouTube, Meta, Telegram и др.).
- Проверяет доступность через загрузку ресурса как `<img>` (favicon / apple-touch-icon), без использования `fetch` (из‑за CORS/opaque responses).
- Опционально отображает колонку **RKN** по локальному снапшоту `data/rkn_snapshot.json`, если файл есть в репозитории.

## Развёртывание на GitHub Pages

1. Создайте репозиторий на GitHub (или используйте существующий).
2. Склонируйте и загрузите файлы проекта:
   ```bash
   git clone https://github.com/YOUR_USER/check_sites.git
   cd check_sites
   # Скопируйте сюда index.html, styles.css, app.js, папку data/, .github/
   git add .
   git commit -m "Initial: diagnostic site"
   git push
   ```
3. В настройках репозитория: **Settings → Pages** → Source: **Deploy from a branch** → Branch: `main` (или `master`) → папка **/ (root)** → Save.
4. Сайт будет доступен по адресу: `https://YOUR_USER.github.io/check_sites/` (если репозиторий называется `check_sites`).

Для проектной страницы (репо `USER.github.io`) корень сайта — корень репо, тогда пути к `data/default_domains.txt` и `data/rkn_snapshot.json` должны быть именно `data/...`.

## Структура проекта

```
/
  index.html      # Страница с UI
  styles.css      # Стили
  app.js          # Логика: загрузка списков, проверка через <img>, таблица, экспорт
  data/
    default_domains.txt   # Fallback-список доменов (~30), если GitHub недоступен
    rkn_snapshot.json     # Опциональный снапшот для колонки RKN (обновляется workflow)
  .github/
    workflows/
      update_rkn_snapshot.yml   # Cron: попытка обновить rkn_snapshot.json (best-effort)
  README.md
```

## Ограничения и РКН

- **Официальный реестр РКН** для операторов связи получают через портал выгрузок и спецпроцедуру. На GitHub Pages полноценно повторить это нельзя.
- В проекте используется **опциональная** колонка «RKN»: она заполняется из файла `data/rkn_snapshot.json` в репозитории. Формат: `{ "domains": { "domain.com": true, "other.com": false }, "updated": "...", "note": "..." }` — `true` = в блоклисте по снапшоту, `false` = нет, при отсутствии ключа в UI показывается «unknown».
- Workflow **Update RKN snapshot** раз в сутки пытается обновить этот файл: берёт домены из allow-domains (Russia inside, до 300), по возможности запрашивает неофициальный API (например rknweb.ru) и строит снапшот. Если запрос блокируется или API недоступен — workflow завершается успешно, но снапшот может остаться пустым или прежним. Это **best-effort**, не гарантия актуальности реестра РКН.

## Локальный запуск

Откройте `index.html` в браузере или поднимите локальный сервер (чтобы корректно подгружались `data/` и не было CORS на файлах):

```bash
python3 -m http.server 8080
# Откройте http://localhost:8080
```

## Использование

1. Выберите **источник списка** (Russia inside RAW, Russia outside RAW или один из Services).
2. Задайте **лимит проверяемых доменов** (50 / 120 / 300). Для 300 отображается предупреждение о длительности и нагрузке.
3. Нажмите **«Запустить проверку»**. Сначала выполняются контрольные проверки (example.com, google.com, raw.githubusercontent.com), затем — выбранный список с пулом запросов и таймаутом 6 с на домен.
4. По итогу отображаются бейдж, метрики (OK / FAIL / TIMEOUT), таблица с фильтрами и поиском. Доступны кнопки **«Остановить»**, **«Повторить только упавшие»** и **«Export JSON»**.

Лицензия: по желанию (например MIT). Домены и списки — из репозитория allow-domains (см. их лицензию).
